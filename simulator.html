<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pandemic Simulator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="simulator.css">
</head>

<body onload="main()">
    <nav>
        <h1>Pandemic Simulator</h1>

        <a href="input.html">&larr; Back</a>
        <p id="info" class="text">Day 1</p>


    </nav>
    <span>

        <button onclick="start()">Start</button>
        <button onclick="stop()">Stop</button>
        <button onclick="pause()">Pause</button>
    </span>

    <span>
        <div id="canvas"></div>
    </span>

    <span>
        <p>Pandemic Spread Visualization</p>
        <canvas id="barChart" class="bars"></canvas>
    </span>
    <span>

        <p>Attribute Values Summary</p>
        <table>
            <thead>
                <tr>
                    <th>Attribute</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Healthy Population</td>
                    <td id="population" title="Total population"></td>
                </tr>
                <tr>
                    <td>Recovery</td>
                    <td id="recovery" title="Number of recovered individuals"></td>
                </tr>
                <tr>
                    <td>Infected</td>
                    <td id="infected" title="Number of infected individuals"></td>
                </tr>
                <tr>
                    <td>Immunity</td>
                    <td id="immunity" title="Number of immune individuals"></td>
                </tr>
                <tr>
                    <td>One Shot</td>
                    <td id="oneShot" title="Number of individuals with one vaccine shot"></td>
                </tr>
                <tr>
                    <td>Two Shot</td>
                    <td id="twoShot" title="Number of individuals with two vaccine shots"></td>
                </tr>
                <tr>
                    <td>Dead</td>
                    <td id="dead" title="Number of individuals that has died"></td>
                </tr>
            </tbody>
        </table>
    </span>
    <span>
        <p>Trend Analysis (Line Graph)</p>
        <canvas id="lineChart"></canvas>
    </span>


    <span>
        <p>Attribute Distribution (Pie Chart)</p>
        <canvas id="doughnutChart" style="width: 25%;"></canvas>
    </span>
    <span>

        <p>Percentage Breakdown of Attributes</p>
        <table>
            <thead>
                <tr>
                    <th>Attribute</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Healthy Population Percent</td>
                    <td id="populationPercent" title="Percentage of total population"></td>
                </tr>
                <tr>
                    <td>Immunity Percent</td>
                    <td id="immunityPercent" title="Percentage of immune individuals"></td>
                </tr>
                <tr>
                    <td>One Shot Percent</td>
                    <td id="oneShotPercent" title="Percentage of individuals with one vaccine shot"></td>
                </tr>
                <tr>
                    <td>Two Shot Percent</td>
                    <td id="twoShotPercent" title="Percentage of individuals with two vaccine shots"></td>
                </tr>
                <tr>
                    <td>Recovery Percent</td>
                    <td id="recoveryPercent" title="Percentage of recovered individuals"></td>
                </tr>
                <tr>
                    <td>Infected Percent</td>
                    <td id="infectedPercent" title="Percentage of infected individuals"></td>
                </tr>
                <tr>
                    <td>Dead Percent</td>
                    <td id="deadPercent" title="Percentage of dead individuals"></td>
                </tr>
            </tbody>
        </table>
    </span>

    <span>

        <p>Simulation Input Parameters</p>
        <table>
            <thead>
                <tr>
                    <th>Input</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Initial Population</td>
                    <td id="populationInput" title="Input population value"></td>
                </tr>
                <tr>
                    <td>Immunity Percent</td>
                    <td id="immunityInput" title="Input immunity percentage"></td>
                </tr>
                <tr>
                    <td>One Shot Percent</td>
                    <td id="oneShotInput" title="Input one shot percentage"></td>
                </tr>
                <tr>
                    <td>Two Shot Percent</td>
                    <td id="twoShotInput" title="Input two shot percentage"></td>
                </tr>
                <tr>
                    <td>Recovery Percent</td>
                    <td id="recoveryInput" title="Input recovery percentage"></td>
                </tr>
                <tr>
                    <td>Infected Percent</td>
                    <td id="infectedInput" title="Input infected percentage"></td>
                </tr>
            </tbody>
        </table>
    </span>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="chart.js"></script>
    <script src="barGraph.js"></script>
    <script src="lineGraph.js"></script>
    <script src="pieChart.js"></script>
    <script>
        var id;
        var day = 1;
        var isStart = false;

        function stop() {
            clearInterval(id);
            isStart = false;
            sendToSession()
        }

        function pause() {
            clearInterval(id);
            isStart = false;
        }

        function start() {
            if (!isStart) {
                isStart = true;

                id = setInterval(() => {
                    if (day >= WEEKS * 7) {
                        stop()
                        console.log("Interval has been cleared.");
                        console.log(temp);

                    }

                    updateSimulation();
                    setPercentAttribute()
                    setAttribute()
                    const dataForDays = getDatasetData();

                    if (dataForDays == null) {
                        stop();
                        return;
                    }

                    document.getElementById("info").innerHTML = "Day " + day;
                    updateBarGraph(dataForDays);
                    updateLineChart(dataForDays, day);
                    updatePieChart(getPercentDataSet())
                    maxMinCases(day)


                    window.addEventListener("resize", () => {
                        window.location.reload()
                    })

                    day++;
                }, TIME);
            }
        }


        start();
        createBarGraph(getDatasetData())
        createLineChart(getDatasetData())
        createPieChart(getPercentDataSet());


    </script>
</body>

</html>